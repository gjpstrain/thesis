<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>related_work</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="2_related_work_files/libs/clipboard/clipboard.min.js"></script>
<script src="2_related_work_files/libs/quarto-html/quarto.js"></script>
<script src="2_related_work_files/libs/quarto-html/popper.min.js"></script>
<script src="2_related_work_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2_related_work_files/libs/quarto-html/anchor.min.js"></script>
<link href="2_related_work_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2_related_work_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2_related_work_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2_related_work_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2_related_work_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">related_work</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="brief-history" class="level1">
<h1>Data Visualisation: A Brief History</h1>
<p>Data visualisation, which can be thought of as the practice of representing information in a visual modality , is difficult to concretely define, classify, and categorise. With the primacy of vision with regards to our interactions with and interpretations of the world around us, data visualisation may be thought of as an extension of art and the written word. Both art and writing are ancient phenomena, with evidence for the former being found in the prehistoric period some 66,000 years ago , and evidence for the latter emerging as Mesopotamian cuneiform around 3200 B.C.E . Broadly, the literature agrees that art emerged prior to the written word; this speaks volumes of the human instinct to represent our thoughts, feelings, emotions, and the ways that we interact with the world pictorially. This instinct has not waned, and modern computing makes it easier than ever for those of us with no technical or artistic skills to create graphics and visualisations that <em>tell stories</em> about our data in ways which are both beautiful and practical.</p>
<!-- When, then, should we consider to be the emergence of data visualisation as a  -->
<!-- human practice? Of course, answering this question requires the provision of a  -->
<!-- definition for the practice itself first. -->
<p>When, then, should we consider to be the emergence of data visualisation as a human practice? Schmandt-Besserat considers clay counting tokens to be the direct precursor of the written word; while the evidence for this link is controversial , the existence of such tokens is not. With each shape of token representing a certain amount of a certain good (measures of grain, jars of oil, etc.), this system could be considered a very early, very simple form of data visualisation (or physicalisation ). Similarly, there is limited evidence of prehistoric cartographic drawings , which may also be considered a form of, or related to, data visualisation. While I am not asserting that data visualisation is older than writing, or that ancient map drawings are equivalent to modern graphics, the existence of these representations emphasises the attractive convenience that symbols and signs represent for humans; making sense of our world and the relationships therein is often easier through pictures as opposed to words and numbers, a principle which I consider key for this thesis.</p>
<!-- Note: much of the rest of this section is heavily inspired by Michael Friendly's -->
<!-- *A Brief History of Data Visualization* \cite{friendly_2008}. -->
<p>Moving on, then, to the kind of pictorial representation that modern students and scientists would firmly recognise as a “data visualisation”. Tufte and Graves-Morris, in 1983’s seminal <em>The Visual Display of Quantitative Information</em> , describe an unattributed time series illustration from the 10th or 11th century, itself described by Funkhouser in 1936 as being discovered by Sigmund Günther in 1877. This illustration is included here in <a href="#fig-early-time-series" class="quarto-xref">Figure&nbsp;1</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-early-time-series" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-early-time-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../supplied_graphics/tufte_1983.png" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-early-time-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Reproduced in Tufte and Graves-Morris, 1983 from Funkhouser, 1936 .
</figcaption>
</figure>
</div>
</div>
</div>
<p>This illustration purports to show the movements of planetary bodies as a function of time, although Funkhouser considered it little more than a “schematic diagram…for illustrative purposes” . Regardless, the recognisable grid lines and sinusoidal variation in the curves are ideas that would not appear again for another 600-700 years, after which they would become mainstream visualisation techniques. In the mid-14th century, French philosopher Nicole Oresme demonstrated an understanding of graphing by plotting proto-bar charts, and by the 16th century, advances in cartography, photography, and mathematics laid the ground for an explosion in data visualisation.</p>
<p>The 17th century saw the birth of geometry and coordinate systems, error measurement, probability, and demographic statistics. With these scientific advancements came the advancements in data visualisation needed to communicate these concepts. For example, in 1626, Scheiner used what Tufte would later term the “principle of small multiples” to illustrate how configurations of sunspots change over time (see <a href="#fig-sunspots" class="quarto-xref">Figure&nbsp;2</a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-sunspots" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sunspots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../supplied_graphics/sunspots.png" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sunspots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Scheiner’s (1626) plot detailing how configurations of sunspots change over time. This technique would later be referred to as the “principle of small multiples” by Tufte.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-cholera" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cholera-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../supplied_graphics/snow_cholera.jpg" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cholera-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: John Snow’s (1854) map of cholera cases in Soho, London. Using this data visualisation, Snow was able to demonstrate a link between cholera cases and a contaminated water supply.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-napoleon" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-napoleon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../supplied_graphics/minard_napoleon.jpg" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-napoleon-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Charles Joseph Minard’s (1869) flow diagram of Napoleon’s botched invasion of Russia in 1812-1813. This diagram shows Napoleon’s advance and retreat on Moscow. The width of the orange and black columns encodes the size of the Grande Armée. The temperature scale on the lower portion of the graph illustrates the weather conditions during the retreat, with a freezing Russian winter causing high rates of attrition.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-nightingale" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nightingale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../supplied_graphics/nightingale-rose.jpg" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nightingale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Florence Nightingale’s (1858) polar area chart illustrates the causes for mortality among British soldiers during the Crimean War. Data visualisations of this type were used to illustrate that in reality, more British soldiers died from preventable disease than were killed by the enemy, and were used as part of a campaign to improve sanitation among soldiers.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The latter half of the 19th century, the so-called “Golden Age of Statistical Graphics” saw the rise of forms of data visualisation that begin to look remarkably similar to the graphs and informatics seen in mass media and scientific publication today. The most notable examples of these are John Snow’s cholera map, which was able to link the incidence of cholera to a contaminated water pump in London (<a href="#fig-cholera" class="quarto-xref">Figure&nbsp;3</a>), Charles Joseph Minard’s flow chart of the Napoleonic invasion of Russia (<a href="#fig-napoleon" class="quarto-xref">Figure&nbsp;4</a>), and Florence Nightingale’s rose diagrams (polar area charts in the modern parlance, see <a href="#fig-nightingale" class="quarto-xref">Figure&nbsp;5</a>). In each of these graphs, visualisation is used with different intent. In John Snow’s cholera map, visualisation was used to track cases of a deadly disease, and facilitated a novel linkage between cholera and contaminated drinking water. In Charles Joseph Minard’s flow chart of Napoleon’s failed 1812 invasion of Russia, a total of six variables are displayed to tell the data story, allowing the viewer to appreciate the movements of the Grande Armée, it’s diminishing size owing to attrition, and the freezing temperatures that largely caused that attrition. Florence Nightingale’s polar area chart depicts the causes of mortality amongst British troops in the Crimean War; charts such as this were used to successfully campaign for better sanitation in hospitals and the front lines.</p>
<p>In all of these visualisations, data is used to accentuate storytelling. In some cases, this may lead to critical discoveries that save lives, and in others, it may simply facilitate a greater understanding and appreciation of the data. In either case, visualisation is used effectively to appeal to our affinity for visual storytelling. An appetite for precision defined the approach to statistical thinking, and by extension, data visualisation, in the first half of the 20th century. Statistical graphics finally became mainstream, and were implemented in curricula and used in government, commerce, and finance. This period also marks the beginning of graphical methods being used to generate new scientific insights, a trend which would only accelerate throughout the next century.</p>
<!-- The most prominent example of this -->
<!-- is Henry Moseley's (1913) discovery of the concept of atomic number \cite{moseley_1913}, -->
<!-- which I will discuss in greater detail in Section \ref{history-corr-viz}. -->
<p>Significant developments in the latter half of the 20th century laid the final brick in the foundations of what would become the modern data visualisation landscape. John W. Tukey’s <em>The Future of Data Analysis</em> proposed a separation between data analysis and mathematical statistics. This seminal work would become hugely influential, and Tukey would go on to invent a great number of analysis-driven data visualisations, including stem-leaf plots and box plots, both of which are now commonplace in software packages and statistics education. In 1967, Jacques Bertin published <em>Sémiologie graphique</em> (<em>Semiology of Graphics</em>), organising the perceptual elements of data visualisations according to their features and their relationships to the underlying data; this work would be influential for Leland Wilkinson’s <em>Grammar of Graphics</em> , which in turn influenced the <code>ggplot2</code> package that is used extensively in this thesis.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-rug-density" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rug-density-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../supplied_graphics/rug_density.png" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rug-density-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Major milestones in the development of data visualisation illustrated using a rug plot and density estimate. This figure is taken from Friendly (2008) .
</figcaption>
</figure>
</div>
</div>
</div>
<p>Since then, both the practice and study of data visualisation have become thoroughly mainstream. Students are taught to visualise data early on, and the propagation of both software and powerful computing hardware have brought advanced techniques, such as high dimensional visualisation and massive datasets, into the home. To summarise the timeline of developments in data visualisation over the last 500 years, I include a rug and density plot from Friendly (2008) in <a href="#fig-rug-density" class="quarto-xref">Figure&nbsp;6</a>. Recounting a full and detailed history of the practice and study of data visualisation would require much more than a single thesis, and has been done to a very high standard elsewhere . Given that this thesis is focused on the perception of correlation in scatterplots, the remainder of the chapter is primarily limited to discussions of relatedness, correlation, and scatterplot visualisations.</p>
</section>
<section id="relatedness-and-correlation" class="level1">
<h1>Relatedness &amp; Correlation</h1>
<p>Very early piloting (detailed in Section <span class="math inline">\(\ref{general-methods-adjusting-opacity}\)</span>, ) revealed that while people understood the concept of correlation, they were unsure as to what different degrees of correlation looked like. To address this, training was included in experiments 1 to 4. For the same reason, correlation was operationalised as <em>Strength of Relatedness</em> in experiment 5. To make my research accessible, I start from here; two (or more) things are related if a change in one is associated with a change in the other(s). In reality, however, the data visualisation under investigation, scatterplots, do not visualise relatedness, but correlation. Correlation refers to a specific statistical relationship, which I explore from first principles below.</p>
<p>Francis Galton was the first to formally introduce the concept of <em>co-relation</em> in 1888 . He derived a definition of correlation as a by-product of his invention of statistical regression, first describing this new property by way of anthropometric data relating to the measurement of different parts of the body. Early in this brief, but significant, paper, Galton puts forward a basic definition of correlation:</p>
<p>Measuring a variety of anatomical distances, including head lengths and heights of a range of “not wholly fully-grown” males, Galton first provides medians and semi-interquartile ranges as a measure of error. Plotting the semi-interquartile ranges (Q-units) of two variables against each other and calculating the slope of the line allowed Galton to devise a new, unitless measure of co-relatedness, which he termed r. This has since been lauded as a prime example of a mathematical discovery made based on observed data. This method is imprecise, as it requires intuition of a line-of-best-fit based on a hand drawn plot, but is credited as the first full conceptual definition of a measure of correlation; it should be noted that there was no concept of negative correlation at this point. Galton’s work did not take place in isolation, and the preceding 60 years featured famous names, such as Gauss and Darwin, dancing around the idea of correlation without recognising its importance; Lee Rodgers &amp; Nicewander (1988) provide an excellent overview of this period.</p>
<p>Building on Galton’s groundbreaking work, his younger, more mathematically-minded student, Karl Pearson, developed the Pearson Product-Moment correlation in 1895 based on initial formulae by Bravais (1844) . This measure has been remarkably persistent, remaining unchanged for well over a century. In fact, many other measures of correlation, such as Spearman’s <span class="math inline">\(\rho\)</span>, the point-biserial correlation, and the <span class="math inline">\(\phi\)</span> coefficient are actually special cases of Pearson’s <em>r</em> applied to different types of data ; such is the dominance of the measure. Equation 2.1 defines Pearson’s <em>r</em>:</p>
<p><span class="math display">\[\begin{equation}
  r = \frac{\sum_{i=1}^{n} (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum_{i=1}^{n} (x_i - \bar{x})^2 \sum_{i=1}^{n} (y_i - \bar{y})^2}}
\end{equation}\]</span></p>
<p>In this equation, <span class="math inline">\(\bar{x}\)</span> and <span class="math inline">\(\bar{y}\)</span> are the means of each variable. <span class="math inline">\(x_i\)</span> and <span class="math inline">\(x_i\)</span> are the individual values of each variable in question. In the numerator, the sum of the products of the difference between each value of <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> and their means are found; this value represents the degree of deviation of all points from the regression line. Then, in the denominator, this value is divided by the magnitude of the sum of the product of said deviations; squaring and finding the square root of these values provides the unsigned magnitude. In statistical language, Pearson’s <em>r</em> finds the covariance of two variables, then divides this value by the product of both variables’ standard deviations. Completing this calculation provides a measure of the overall distance between the observed values and a fitted least squares regression line, and provides a single value of <em>r</em> that describes how strongly related two variables are.</p>
</section>
<section id="visualising-correlation" class="level1">
<h1>Visualising Correlation</h1>
<div class="cell">
<div class="cell-output-display">
<div id="fig-anscombe" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-anscombe-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="2_related_work_files/figure-html/fig-anscombe-1.png" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-anscombe-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Anscombe’s quartet . Each scatterplot depics datasets with identical means (<span class="math inline">\(x\)</span> = 9, <span class="math inline">\(y\)</span> = 7.5), regression coefficients (<span class="math inline">\(y\)</span> on <span class="math inline">\(x\)</span> = 0.5), standard errors (0.118), and Pearson’s <em>r</em> values (≈ 0.816).
</figcaption>
</figure>
</div>
</div>
</div>
<p>Of course, while mathematically sound, a single value provides no information about the distribution of variables from which it was derived. To do this, the data must be examined visually. Here arises a parallel; in much the same way as Francis Galton used a proto-scatterplot to formulate his definition of correlation, so must data visualisation be used to tell the story behind a value of Pearson’s <em>r</em>. The need for visualisation is most viscerally illustrated by Anscombe’s quartet , which is recreated in <a href="#fig-anscombe" class="quarto-xref">Figure&nbsp;7</a> using a dataset from the <code>datasets</code> core package in R. Anscombe’s quartet describes four simple datasets that are identical with regards to a range of statistical measures. They feature the same number of observations, the same means, regression coefficients, regression line equations, sums of squares, estimated standard errors, and correlation coefficients. A simple examination of these statistics would lead to the conclusion that the datasets are almost identical; in reality, there are significant differences between them that can only be seen via visualisation.</p>
<p>In this thesis, the primary concern is correlation and the ways in which people interpret it from scatterplots. The remainder of this section examines the history and current landscape of correlation visualisations. Starting with Galton’s scatterplot precursors, I then go on to discuss the development of the familiar modern scatterplot through the examination of a number of impressive use cases. Following that, I review the current landscape of correlation visualisation, including the more recent use of other, non-scatterplot graphs.</p>
<section id="history-corr-viz" class="level2">
<h2 class="anchored" data-anchor-id="history-corr-viz">History</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-galton-hand-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-galton-hand-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="2_related_work_files/figure-html/fig-galton-hand-plot-1.png" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-galton-hand-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Francis Galton’s original plot comparing the semi-interquartile ranges of stature (height) and cubit (forearm length). The plot has been recreated using <code>ggplot2</code> on the right.
</figcaption>
</figure>
</div>
</div>
</div>
<p>As mentioned in Section <span class="math inline">\(\ref{relatedness-and-correlation}\)</span>, Francis Galton based his initial formulation of the correlation coefficient on hand-drawn plots of the semi-interquartile ranges of two variables. <a href="#fig-galton-hand-plot" class="quarto-xref">Figure&nbsp;8</a> contains a negative scan of Galton’s original plot, along with a modern recreation using <code>ggplot2</code>. Despite the importance of graphics like these for Galton’s discovery of regression, statistical correlation, and the relationship between these and the bivariate density function , a more true example of a scatterplot can be found in much earlier work on the orbits of twin stars by John F. W. Herschel . Unfortunately, this scatterplot was never printed in Herschel’s 1833 manuscript, however can be inferred thanks to a detailed description of both the figure and the logic behind it. In short, Herschel wished to ascertain the orbits of binary star systems by using (often imprecise) astronomical measurements of certain angles and distances made over a long period of time. It is the imprecision in measurement which necessitated data visualisation, as precise measurements would allow common astronomical principles to provide precise solutions. First specifying the axes, angles of position (<span class="math inline">\(y\)</span>) and date of observation (<span class="math inline">\(x\)</span>), and grid lines, Herschel then describes plotting points and drawing, by hand, a line-of-best-fit. A particularly enlightening quote, with original emphasis, is reproduced below:</p>
<p>From this smoothed-by-eye line, Herschel was able to calculate the parameters that determined the rotation of the <span class="math inline">\(\gamma\)</span>Virginis system. Herschel beat out Galton by more than 50 years to claim the first scatterplot, in a remarkable feat of using graphing to solve an astronomical problem. Just a few decades after Galton had discovered the concept of correlation, yet another astronomical example of a scatterplot can be found in the Hertzsprung-Russell diagram, created independently by both Ejnar Hertzprung and Henry Norris Russell in 1911-1913 . This type of scatterplot, which still sees use in modern astronomy, plots stellar luminosity against colour (temperature). I have plotted an HR diagram in <a href="#fig-HR-plot" class="quarto-xref">Figure&nbsp;9</a> using the HYG database <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-HR-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-HR-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="2_related_work_files/figure-html/fig-HR-plot-1.png" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-HR-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Hertzsprung-Russell diagram of colour index against stellar luminosity. The code for this plot was taken from John Russell’s (no relation) blog .
</figcaption>
</figure>
</div>
</div>
</div>
<p>The clear band that can be seen in <a href="#fig-HR-plot" class="quarto-xref">Figure&nbsp;9</a> from top-left to bottom right are “main sequence” stars. It was only by visualisation that astronomers were able to determine that there were laws that govern the formation and evolution of stars. Spence and Garrison conducted a detailed analysis of the history and development of HR diagrams, and conclude that they represent a “shining example of the power of graphic display”. Again, it was the ability of the data visualisation to facilitate pattern recognition in its human viewers that was so crucial to its (continuing) success.</p>
<p>While this section has not been an exhaustive list of every scatterplot and scatterplot-alike that has prominently featured in scientific publishing since Herschel’s initial description and Galton’s initial formulation of correlation, I hope that I have conveyed the importance of this visualisation type. As we will see in Section <span class="math inline">\(\ref{present-landscape-corr-viz}\)</span>, the landscape of correlation visualisation is now much broader, however the humble scatterplot still remains a crucial part of the visualiser’s toolbox. From its origins as a way of inferring astronomical relationships, to its use in the discovery of correlation, the standard scatterplot remains largely unchanged to this day; this thesis charts the development of a new type of scatterplot that draws on key elements of human perception to increase its utility in correlation visualisation, however it is important to pay homage to the history of the visualisation as an ever-present lab mate to those willing and able to use graphing to solve scientific problems.</p>
</section>
<section id="present-landscape-corr-viz" class="level2">
<h2 class="anchored" data-anchor-id="present-landscape-corr-viz">Present Landscape</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-other-corr-viz" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-other-corr-viz-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="2_related_work_files/figure-html/fig-other-corr-viz-1.png" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-other-corr-viz-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: From left to right: Parallel Coordinates Plot (PCP) built with the <code>GGally</code> package ; Stacked area plot; radial stacked bar plot (doughnut plot); radar plot. Each plot uses the same dataset with an <em>r</em> value of 0.6.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-remixes" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-remixes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="2_related_work_files/figure-html/fig-remixes-1.png" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-remixes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Hexbin (left) and Kernel Density Estimation (KDE, right) plots. These are binned, density-flavoured versions of standard scatterplots.
</figcaption>
</figure>
</div>
</div>
</div>
<p>When I began this project in the autumn of 2021, I believed that scatterplots were the first and last word when it came to visualising correlation. I soon discovered that this was not the case; as scientists often do, a whole host of other visualisation types had been designed or adapted in an effort to better visualise correlation. Parallel Coordinates Plots (PCPs) , which are popular in the InfoVis community, are most often used for multidimensional data. Applying them to bivariate data results in plots that perform (almost) as well as scatterplots with regards to visualising correlation between two variables . <a href="#fig-other-corr-viz" class="quarto-xref">Figure&nbsp;10</a> illustrates parallel coordinates plots, along with 3 other types of correlation visualisation, with an <em>r</em> value of 0.6. Despite the existence of plots such as these, scatterplots remain by far the most popular way of visualising correlation. With the exception of the charts featured in <a href="#fig-other-corr-viz" class="quarto-xref">Figure&nbsp;10</a>, many other ways of visualising correlation are density-flavoured remixes of traditional scatterplots, such as Hexbin plots and Kernel Density Estimate plots (see <a href="#fig-remixes" class="quarto-xref">Figure&nbsp;11</a>). While there may be many, often more visually appealing ways of visualising correlation, traditional scatterplots offer a number of distinct advantages.</p>
</section>
<section id="scatterplots-corr-viz" class="level2">
<h2 class="anchored" data-anchor-id="scatterplots-corr-viz">Scatterplots</h2>
<p>In a large scale study, Harrison et al.&nbsp; tested a range of correlation visualisation types, including scatterplots and those depicted in <a href="#fig-other-corr-viz" class="quarto-xref">Figure&nbsp;10</a>, to see if precision in correlation estimation could be modelled by Weber’s law . In short, the perception of differences in correlation has a linear relationship to the objective differences in correlation. In this study, itself a replication of a previous work investigating Weber’s law for the modelling of perceived correlation , participants were asked to make discriminative judgements between side-by-side correlation visualisations. An adaptive staircase procedure was employed to infer just-noticeable differences (JNDs) for correlation perception with nine correlation visualisation types. Both positive and negative correlations were tested. Fitting linear models to the JND data revealed that correlation discrimination in the nine different visualisations tested (scatterplots, PCPs, stacked area charts, stacked line charts, stacked bar charts, donut charts, radar charts, line graphs, and ordered line graphs) could be modelled using Weber’s law. This study also provides a ranking of the tested visualisation types with regards to participant’s correlation discrimination performance; overall, traditional scatterplots outperformed all other visualisation types with positively correlated data, and were tied with PCPs for negatively correlated data.</p>
<p>Rensink (2014) measured correlation discriminability for scatterplots presented at 100, 400, or 1600 milliseconds. This study found that performance was almost identical for scatterplots presented for either 400 or 1600 milliseconds, and that there was only a small deterioration in performance for those presented for 100 milliseconds. The lack of performance improvement for longer presentation times both facilitates the rapid collection of large amounts of data and speaks to the intuitive nature of correlation perception in scatterplots.</p>
<p>Finally, scatterplots, in addition to outperforming other visualisation types and featuring rapid interpretation, are also ubiquitous. In 1983, scatterplots were estimated to account for between 70% and 80% of data visualisations in scientific publications . With the advances in computers and graphing techniques seen since then, this proportion is certainly lower today. Regardless, scatterplots, their derivatives, and their remixes can be seen not only in scientific and technical publication, but also in the news and mass media. This combination of advantages makes them particularly suitable for scientific study, and was part of the reason I chose to pursue this project.</p>
<p>Despite this host of advantages, the estimation of correlation suffers from routine underestimation by viewers. To understand this bias with a view to correcting for it, I first explore the perception of correlation more generally, before briefly discussing the more cognitive aspects of the measure, which are especially relevant for the experiment described in . I then deal with the problem itself; the underestimation of correlation in positively correlated scatterplots, before finishing this chapter by discussing data visualisation and statistical literacy and stating the research objectives and contributions of this thesis.</p>
</section>
</section>
<section id="corr-percept-related-work" class="level1">
<h1>Correlation Perception</h1>
<p>Understanding the perception of correlation represents a complex problem. Despite decades of research into correlation, scatterplots, and the perception of information from visualisations, there is no definitive solution to this problem. Circumstantial evidence exists, however, that points to correlation perception being driven by the shape of the probability distribution represented by the scatterplot.</p>
<p>Firstly, increasing the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> scales of a scatterplot such that the size of the point cloud increases is associated with an increase in viewers’ judgements of bivariate association, despite the objective <em>r</em> value remaining the same . This finding suggests that it is the area of the point cloud that viewers may use to judge correlation. This area is easier to visualise in hexbin or KDE plots (see <a href="#fig-remixes" class="quarto-xref">Figure&nbsp;11</a>). With enough data, the point cloud of a scatterplot will tend towards a straight line as the <em>r</em> value increases, decreasing the area of the point cloud in the same way. <a href="#fig-point-cloud-trends" class="quarto-xref">Figure&nbsp;12</a> illustrates this.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-point-cloud-trends" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-point-cloud-trends-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="2_related_work_files/figure-html/fig-point-cloud-trends-1.png" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-point-cloud-trends-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Scatterplot with Pearson’s = 0.95 (left) and Pearson’s = 0.4 (right).
</figcaption>
</figure>
</div>
</div>
</div>
<p>In 1997, Meyer et al.&nbsp; asked participants to provide estimates of correlation from scatterplots. They found that people’s estimates of correlation could be related to the objective correlation using a psychophysical function taking the following form:</p>
<p><span class="math display">\[\begin{equation}
  r_{est} = 1 - aX^b
\end{equation}\]</span></p>
<p><span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are constant coefficients, while X represents the mean absolute vertical distance between the scatterplot points and a regression line. This modelling provides further evidence that estimates of correlation are based on perceptions of the physical arrangement of scatterplot points. This finding received later support from a study investigating the hypothesis that visual features may be used to judge correlations in scatterplots . In that study, it was found that, among other equally predictive visual features, the standard deviation of all perpendicular distances between scatterplot points and the regression line is predictive of performance on a correlation estimation task.</p>
<p>Additionally, equations described by Rensink (2017) linking subjective and objective <em>r</em> values include a <span class="math inline">\(u\)</span> parameter. For both discrimination and magnitude judgements, this parameter is small when <em>r</em> = 1 and increases as <em>r</em> approaches 0.This quantity is indifferent to the type of visualisation used (e.g.&nbsp;line graphs and bar charts or augmented stripplots ), and is functionally similar to that found in work mentioned above . Regarding scatterplots, this quantity represents the average distance between data points and the regression line, and can be thought of as closely approximating the width of the underlying probability distribution. Findings from a convolutional neural network that learnt visual features related to correlation perception also support the idea that viewers are using an aspect of the shape of the point cloud to judge correlation, or some measure of what has been termed <em>dot entropy</em> , again considered a candidate visual proxy for correlation judgements .</p>
<p>While none of this is strong evidence that people actually use the width of the probability distribution represented by the arrangement of scatterplot points as a basis for their judgements of correlation, the fact that such measures are <em>predictive</em> of performance suggests that they are at least a good proxy for what is really going on. This naturally led me to believe that ways in which these perceptions may be altered might also result in changes in how viewers interpret correlation.</p>
</section>
<section id="corr-cognition" class="level1">
<h1>Correlation Cognition</h1>
<p>Thinking about the ways in which variables are related to one another is more complicated than simply perceiving the differences in relatedness. Particularly due to the speeds with which people are able to judge correlations , experiments that aim to investigate cognition require more complicated designs. Generally, interacting with data visualisation is a complex process involving bottom-up and top-down mechanisms . Visualisation design methodologies often begin by clarification of the problem space ; the problem I chose to address was the underestimation of correlation in positively correlated scatterplots. Due to this problem being perceptual in nature, I began by focusing on, and attempting to exploit, aspects of human perception. Only once I felt that this had been explored did I begin examining this problem from a top-down, cognitive point of view; these efforts are detailed in .</p>
<p>Regardless, an account of how correlation is thought about by viewers is not a contribution of this thesis. Section <span class="math inline">\(\ref{future-work-chap8}\)</span> in discusses how the findings presented in this thesis may be extended further into a cognitive space to more rigorously interrogate the effects found in the final experiment.</p>
</section>
<section id="the-underestimation-of-correlation-in-positively-correlated-scatterplots" class="level1">
<h1>The Underestimation of Correlation in Positively Correlated Scatterplots</h1>
<p>While the previous section may have painted scatterplots as a shining example of data visualisation done right, that is not the full story. Since at least the 1960s, studies asking participants to simply provide a numerical estimate for the correlation displayed in positively correlated scatterplots and those asking participants to complete a bisection task comparing adjacent scatterplots find consistent levels of underestimation, particularly when 0.2 &lt; <em>r</em> &lt; 0.6. Where sufficient data are available to recreate a full estimation curve, the nature of this underestimation has been visualised in <a href="#fig-underestimation-curves" class="quarto-xref">Figure&nbsp;13</a>. Included are estimation curves derived from medians described by Bobko (1979 ) and from an equation relating subjective to objective correlation derived from JND studies by Rensink (2017 ).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-underestimation-curves" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-underestimation-curves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="2_related_work_files/figure-html/fig-underestimation-curves-1.png" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-underestimation-curves-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Using an equation supplied in Rensink (2017) , and recorded median correlation estimates in Bobko (1979 ), the nature of correlation underestimation may be visualised. The solid lines represents underestimation behaviour, while the dashed diagonal line represents theoretically perfect estimation.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The underestimation of correlation in positively correlated scatterplots was also observed in experiments 1 to 4 in the current paper, and is detailed in each experimental chapter. includes figures detailing the underestimation observed throughout this thesis in comparison to previous work. Despite this long-standing finding, no efforts have been made to correct for this underestimation. Quite why this correction has never been attempted, however, is unclear. The following section argues in favour of seeking a correction to this underestimation bias.</p>
<section id="underestimation-consequences" class="level2">
<h2 class="anchored" data-anchor-id="underestimation-consequences">Underestimation: Potential Consequences</h2>
<p>As detailed at the beginning of this chapter, humans have a natural inclination towards the pictorial representation of data. There is evidence that statistical information is more persuasive than anecdotal and causal information , and that, under certain conditions, data visualisations are more persuasive than tabular data . Data visualisations have been submitted as evidence in court cases , and play key roles in organisational decision making, including in healthcare . Data visualisation also plays a huge role in the communication of vital public health information, including during the COVID-19 pandemic ; from personal experience, this was when data visualisation entered the public conscience for many.</p>
<p>All this is to say that the underestimation of correlation matters. It is not unreasonable to assert that policy decisions have been made based at least in part on data visualisations; the long-standing finding that lay people and those educated in statistics underestimate the levels of relatedness between variables displayed in scatterplots is not trivial, and has real impact on people’s lives. Those who design data visualisations have a responsibility to design with <em>all</em> viewers in mind, not merely those who have made statistics a part of their working lives. Designing in this way requires us to understand, on perceptual and cognitive levels, how visualisations are interpreted, and to apply this understanding to scaffold the hidden processes that allow pictorial representations to convey more than words and numbers alone ever could.</p>
</section>
</section>
<section id="graph-literacy-related-work" class="level1">
<h1>Data Visualisation Literacy</h1>
<p>Proponents of Inclusive Design argue for replacing the idea that people are disabled by physical and mental impediments with the idea that we are all, at different times, disabled by poor design and a lack of consideration of the full range of human capabilities. This concept led me to design and test novel scatterplot visualisations solely with lay populations; this is in stark contrast to most of the correlation perception studies cited in this thesis, which overwhelmingly take place with university staff and students in statistics and psychology departments. While I would argue that this leads to more generalisable results, especially as I did not pursue purely perceptual conclusions (rather used aspects of perception to inform design), it is also important to recognise and account for the differences in ability in lay populations. Research has shown that those with a greater level of skill in working with data visualisations tend to benefit more from their provision , and that differences in these skills may account for variations in experimental results regarding judgements of magnitude .</p>
<p>With this in mind, some measure of a participant’s ability to comprehend the data visualisation displayed was required. Throughout this thesis, Garcia-Retamero’s 5-item Subjective Graph Literacy (SGL) scale was employed to accomplish this. Based on Galesic and Garcia-Retamero’s 13-item graph literacy scale, which is itself based on work by Friel’s work on graph comprehension , the SGL scale is quick to complete (&lt; 1 minute), and correlates strongly with an objective measure of graph literacy that has been shown to accurately predict to extent to which participants may benefit from visual aids . Using the 13-item scale, it has also been shown that those with low graph literacy suffer from higher levels of misinterpretation and more often rely on misleading mappings .</p>
<p>The SGL was administered in each experiment described in this thesis, and takes the form of 5 questions to which participants must provide an answer. Generally, the scale ascertains each participant’s self-reported competencies when working with a small range of visualisations. The SGL test portion of each experiment is shown in <a href="#fig-sgl-screen" class="quarto-xref">Figure&nbsp;14</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-sgl-screen" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sgl-screen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../supplied_graphics/sgl_test_screen.png" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sgl-screen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Participants were instructed to use the following interface to complete the Subjective Graph Literacy scale before completing trials in each experiment.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="objectives-contributions" class="level1">
<h1>Objectives and Contributions</h1>
<p>In this thesis, I aim to answer three high-level research questions:</p>
<ol type="1">
<li>Are there effects of changing the sizes and opacities of scatterplot points on performance on a correlation estimation task?</li>
<li>Can these changes be used to correct for a historic underestimation bias?</li>
<li>Are these effects only perceptual, or do participants integrate them cognitively such that they may influence beliefs about correlations?</li>
</ol>
<p>The justifications and motivations for these research questions may be found in the experimental chapters where they are most relevant. Both in answering the above questions and in conducting this project more generally, I hope to make the following contributions:</p>
<ol type="1">
<li>There are clear and strong effects of changing the opacities and sizes of points on scatterplots, both in uniform ways, and using functions that draw inspiration from the nature of correlation perception.</li>
<li>These effects can be used to correct for the historic underestimation bias, without removing data, although significantly more work is needed to find the exact combinations of size and opacity adjustments that produce perceptually-optimised estimates.</li>
<li>These effects do extent into a cognitive space, and are able to influence people’s beliefs about the levels of relatedness between variables.</li>
<li>This project is exemplar of one done in an entirely open and reproducible manner.</li>
</ol>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>https://www.astronexus.com/projects/hyg<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>